import{openBlock as t,createBlock as e,renderSlot as i,createVNode as n,Transition as s,createCommentVNode as a,withScopeId as r,pushScopeId as o,popScopeId as u,resolveComponent as d,TransitionGroup as h,Fragment as c,renderList as l}from"vue";var f=function(t){return{status:t?3:0,touchId:null,start:{},move:{},startPoint:1,result:null}},p=0,y=1,m=2,v=3,w=4,x={name:"TinderCard",emits:["reverted"],props:{tinderMounted:{type:Boolean,default:!1},index:{type:Number,required:!0},ready:{type:Boolean,default:!1},state:{type:Object,required:!0},ratio:{type:Number,default:0},rewind:{type:[Number,Boolean],default:!1},scaleStep:{type:Number,required:!0},offsetY:{type:Number,required:!0},offsetUnit:{type:String,required:!0}},data:function(){return{inited:!1,scopedRewind:!1,willDestory:!1}},computed:{curScale:function(){return this.scaleStep*this.index},isCur:function(){return 0===this.index},style:function(){return this.inited?this.state.status===y?this.movingStyle:this.normalStyle:{}},normalStyle:function(){return this.isCur?{opacity:1,transform:"translate3d(0,0,0) rotate(0) scale3d(1,1,1)",transition:"all 500ms cubic-bezier(0.175, 0.885, 0.32, 1.275), z-index 0s"}:{opacity:this.ready?0:1,transform:this.getTransform(),transition:"all 500ms cubic-bezier(0.175, 0.885, 0.32, 1.275) ".concat(this.scopedRewind?80*this.scopedRewind:0,"ms, z-index 0s")}},movingStyle:function(){var t={transition:"none"};if(this.isCur){var e=this.state,i=e.start,n=e.move,s=e.startPoint,a=n.x-i.x||0,r=n.y-i.y||0,o=10*this.ratio*s;t.transform="translate3d(".concat(a,"px,").concat(r,"px,0) rotate(").concat(o,"deg)")}else{var u=Math.abs(this.ratio);u>1&&(u=1),this.ready&&(t.opacity=1*u),t.transform=this.getTransform(u)}return t}},watch:{index:function(t,e){t<e&&(this.scopedRewind=!1)}},created:function(){this.scopedRewind=this.rewind,this.tinderMounted||(this.inited=!0)},mounted:function(){var t=this;requestAnimationFrame((function(){t.inited=!0}))},methods:{transitionEnd:function(t){if(t.target===t.currentTarget&&"transform"===t.propertyName&&(this.scopedRewind=!1,this.isCur)){var e=this.state.status;e!==v&&e!==w||this.$emit("reverted")}},getTransform:function(t){var e=this.index,i=0,n=1-this.scaleStep*e;if(t&&(n+=t*this.scaleStep),this.offsetY){var s=this.offsetY<0,a=Math.abs(this.offsetY),r=e*a,o=(1-n)/2*100;t&&(r-=t*a),s&&(r*=-1,o*=-1),i="calc(".concat(o,"% + ").concat(r).concat(this.offsetUnit,")")}return"translate3d(0,".concat(i,",0) scale3d(").concat(n,",").concat(n,",1)")}}},g=r("data-v-7d6ecee4"),b=g((function(r,o,u,d,h,c){return t(),e("div",{"data-index":u.index,class:"tinder-card",style:[{zIndex:100-u.index},c.style],onTransitionend:o[1]||(o[1]=function(){return c.transitionEnd&&c.transitionEnd.apply(c,arguments)})},[i(r.$slots,"default"),i(r.$slots,"nope"),i(r.$slots,"like"),i(r.$slots,"super"),i(r.$slots,"down"),n(s,{name:"tinder-rewind"},{default:g((function(){return[!1!==r.scopedRewind?i(r.$slots,"rewind",{key:0}):a("",!0)]})),_:1})],44,["data-index"])}));x.render=b,x.__scopeId="data-v-7d6ecee4";var O=function(t,e){for(var i=[],n=0;n<t.length&&!(e.indexOf(t[n])>-1);n++)i.push(t[n]);return i};function T(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||S(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){if(t){if("string"==typeof t)return I(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?I(t,e):void 0}}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var $,z={name:"Tinder",emits:["update:queue","submit"],mixins:[{data:function(){return{leavingKeys:[],onceRewindCount:0}},methods:{diff:function(t,e){var i=this.keyName,n=O(t,e),s=0;if(n.length)for(var a=0;a<n.length;a++){var r=this.queue[a];if(!r[i]||n[a]!==r[i])break;s++;var o=r[i],u=o+Math.random();if(this.leavingKeys.indexOf(r.$vtKey)>-1||this.leavingKeys.indexOf(o)>-1||this.rewindKeys.indexOf(r.$vtKey)>-1||this.rewindKeys.indexOf(o)>-1){r.$vtKey=u;var d=Math.max(this.rewindKeys.indexOf(r.$vtKey),this.rewindKeys.indexOf(o));d>-1&&(this.rewindKeys[d]=u,this.state.status=w)}}this.onceRewindCount=s;var h=O(e,t);if(h.length){this.leavingKeys.push(this.list[0].$vtKey||this.list[0][i]);for(var c=this.max+1;c<this.max+1+h.length;c++){var l=this.list[c];l&&(this.leavingKeys.indexOf(l[i])>-1||this.hidingKeys.indexOf(l[i])>-1)&&(l.$vtKey=l[i]+Math.random())}}this.list=this.queue.slice(0)}}},{methods:{start:function(t){if(null===this.state.touchId&&this.status!==m&&this.status!==v&&this.status!==w){var e,i;"touchstart"===t.type?(e=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY):(e=t.clientX,i=t.clientY);var n=i>this.size.top+this.size.height/2?-1:1;this.state={status:y,touchId:"touchstart"===t.type?t.changedTouches[0].identifier:"mouse",start:{x:e,y:i},move:Object.create(null),startPoint:n,result:null}}},move:function(t){t.preventDefault();var e,i,n=this.state;null===n.touchId||this.status===m||this.status===v||this.status===w||"touchmove"===t.type&&n.touchId!==t.changedTouches[0].identifier||("touchmove"===t.type?(e=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY):(e=t.clientX,i=t.clientY),n.move={x:e,y:i})},end:function(t){if(("touchstart"!==t.type||this.state.touchId===t.changedTouches[0].identifier)&&this.status!==m&&this.status!==v&&this.status!==w)if(Math.abs(this.pointerOpacity)>=1||this.superOpacity>=1||this.downOpacity>=1){var e=this.superOpacity>=1?"super":this.downOpacity>=1?"down":this.pointerOpacity>0?"like":"nope";this.shiftCard(e)}else this.status===y&&(this.state=f("reverted"))}}},{data:function(){return{leavedCount:0,hideIndex:50,lastHideIndex:50,hidingKeys:[]}},methods:{beforeEnter:function(t){var e=t.dataset.index-0+1;if(t.style.opacity=0,t.style.transform=this.getTransform(e),this.rewindKeys.indexOf(t.dataset.id)>-1){var i=-1,n=(i+=this.size.width*(i<0?-.5:.5))/(.5*this.size.width)/1.6*15*1;t.style.transform="translate3d(".concat(i,"px, 0, 0) rotate(").concat(n,"deg)")}t.style.transition="all 0s"},leave:function(t,e){var i=this,n=this.state,s=n.start,a=n.move,r=n.startPoint,o=a.x-s.x||0,u=a.y-s.y||0;"super"===n.result?u-=this.size.width:"down"===n.result?u+=this.size.width:u*=(o+=this.size.width*(o<0?-.5:.5))/(a.x-s.x);var d=o/(.5*this.size.width)/1.6*15*r,h=null===n.touchId||"super"===n.result||"down"===n.result?800:300;if(t.style.opacity=0,t.style["pointer-events"]="none",this.leavingKeys.indexOf(t.dataset.id)>-1)t.className+=" ".concat(n.result),t.style.transform="translate3d(".concat(o,"px,").concat(u,"px,0) rotate(").concat(d,"deg)"),t.style.zIndex=1e6-this.leavedCount++;else{this.hidingKeys.push(t.dataset.id),h=500;var c=Math.min(this.max,this.onceRewindCount)+(t.dataset.index-0);t.style.transform=this.getTransform(c),t.style.zIndex=this.getHideIndex(t.dataset.index-0)}t.style.transition="all ".concat(h,"ms ").concat(500===h?"cubic-bezier(0.175, 0.885, 0.32, 1.275)":"ease",",z-index 0s"),t.addEventListener("transitionend",(function(n){"transform"===n.propertyName&&(i.lastHideIndex===t.style.zIndex-0&&(i.lastHideIndex=50,i.hideIndex=50),!i.sync||i.status!==p&&i.status!==m||i.resetStatus(),e())})),this.sync||t.dataset.index-0!=0||this.status===w||this.resetStatus()},getHideIndex:function(t){var e,i=this.max;return t===i?this.lastHideIndex>this.hideIndex?(e=this.hideIndex,this.hideIndex+=1+i):e=this.hideIndex++:e=this.hideIndex+i-t,this.lastHideIndex=e,e},getTransform:function(t){var e=1-this.scaleStep*t,i=0;if(this.offsetY){var n=this.offsetY<0,s=t*Math.abs(this.offsetY),a=(1-e)/2*100;n&&(s*=-1,a*=-1),i="calc(".concat(a,"% + ").concat(s).concat(this.offsetUnit,")")}return"translate3d(0,".concat(i,",0) scale3d(").concat(e,",").concat(e,",1)")}}},{data:function(){return{rewindKeys:[]}},methods:{decide:function(t){!this.state.touchId&&this.status===p&&this.queue.length&&(this.state.start={x:0,y:0},this.state.move={x:"super"===t||"down"===t?0:"like"===t?1:-1,y:"super"===t?-1:"down"===t?1:0},this.state.startPoint=1,this.shiftCard(t))},rewind:function(t){var e,i,n=this.keyName,s=function(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=S(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw a}}}}(t);try{for(s.s();!(i=s.n()).done;){var a=i.value;this.rewindKeys.push(a[n]+"")}}catch(r){s.e(r)}finally{s.f()}(e=this.queue).unshift.apply(e,T(t)),this.$emit("update:queue",this.queue.slice(0))},shiftCard:function(t){this.state.status=m,this.state.result=t;var e=this.queue.shift();this.$emit("update:queue",this.queue.slice(0)),this.submitDecide(t,e)},submitDecide:function(t,e){this.$emit("submit",{type:t,key:e[this.keyName],item:e})}}}],components:{TinderCard:x},props:{allowSuper:{type:Boolean,default:!0},allowDown:{type:Boolean,default:!1},queue:{type:Array,default:function(){return[]}},keyName:{type:String,default:"key"},pointerThreshold:{type:Number,default:.5},superThreshold:{type:Number,default:.5},downThreshold:{type:Number,default:.5},sync:{type:Boolean,default:!1},max:{type:Number,default:3},scaleStep:{type:Number,default:.05},offsetY:{type:Number,default:0},offsetUnit:{type:String,default:"px"}},data:function(){return{size:{top:0,width:0,height:0},state:f(),list:[],tinderMounted:!1}},computed:{status:function(){return this.state.status},ratio:function(){if(this.size.width){var t=this.state,e=t.start;return(t.move.x-e.x||0)/(.5*this.size.width)}return 0},pointerOpacity:function(){return this.ratio/this.pointerThreshold},disY:function(){return this.allowSuper||this.allowDown?this.state.move.y-this.state.start.y:0},superOpacity:function(){if(!this.allowSuper)return 0;var t=this.disY/(-this.superThreshold*this.size.height);return t>Math.abs(this.pointerOpacity)?t:0},downOpacity:function(){if(!this.allowDown)return 0;var t=this.disY/(this.downThreshold*this.size.height);return t>Math.abs(this.pointerOpacity)?t:0},likeOpacity:function(){return this.superOpacity||this.downOpacity?0:this.pointerOpacity},nopeOpacity:function(){return-this.likeOpacity}},watch:{queue:function(t){var e=this.keyName,i=t.map((function(t){return t[e]})),n=this.list.map((function(t){return t[e]}));this.diff(i,n)}},mounted:function(){this.$el.offsetWidth&&this.$el.offsetHeight?(this.size={top:this.$el.offsetTop,width:this.$el.offsetWidth,height:this.$el.offsetHeight},window.onresize=this.getSize,this.tinderMounted=!0):console.error("请设置vue-tinder的宽高")},created:function(){this.list=this.queue.slice(0)},unmounted:function(){window.removeEventListener("onresize",this.getSize)},methods:{getSize:function(){var t=this;clearInterval($),$=setTimeout((function(){t.size={top:t.$el.offsetTop,width:t.$el.offsetWidth,height:t.$el.offsetHeight}}),300)},resetStatus:function(){this.state=f()}}},k=r("data-v-808629f4");o("data-v-808629f4");var K={key:1,slot:"rewind",class:"pointer-wrap rewind-pointer-wrap"};u();var M=k((function(s,r,o,u,f,p){var y=d("TinderCard");return t(),e(h,{class:"vue-tinder",tag:"div",css:!1,onBeforeEnter:s.beforeEnter,onLeave:s.leave,onTouchstart:s.start,onTouchmove:s.move,onTouchend:s.end,onTouchcancel:s.end,onMousedown:s.start,onMousemove:s.move,onMouseup:s.end},{default:k((function(){return[(t(!0),e(c,null,l(s.list,(function(r,u){return t(),e(c,null,[u<o.max+1?(t(),e(y,{ready:u===o.max,key:r.$vtKey||r[o.keyName],"data-id":r.$vtKey||r[o.keyName],index:u,state:s.state,ratio:p.ratio,rewind:s.rewindKeys.indexOf(r.$vtKey||r[o.keyName])>-1&&u,"tinder-mounted":s.tinderMounted,"scale-step":o.scaleStep,"offset-y":o.offsetY,"offset-unit":o.offsetUnit,onReverted:p.resetStatus},{default:k((function(){return[i(s.$slots,"default",{data:r,index:u,status:p.status}),0===u&&2!==p.status?(t(),e(c,{key:0},[n("span",{slot:"nope",class:"pointer-wrap nope-pointer-wrap",style:{opacity:p.nopeOpacity}},[i(s.$slots,"nope",{opacity:p.nopeOpacity})],4),n("span",{slot:"like",class:"pointer-wrap like-pointer-wrap",style:{opacity:p.likeOpacity}},[i(s.$slots,"like",{opacity:p.likeOpacity})],4),o.allowSuper?(t(),e("span",{key:0,slot:"super",class:"pointer-wrap super-pointer-wrap",style:{opacity:p.superOpacity}},[i(s.$slots,"super",{opacity:p.superOpacity})],4)):a("",!0),o.allowDown?(t(),e("span",{key:1,slot:"down",class:"pointer-wrap down-pointer-wrap",style:{opacity:p.downOpacity}},[i(s.$slots,"down",{opacity:p.downOpacity})],4)):a("",!0)],64)):a("",!0),4===s.state.status?(t(),e("span",K,[i(s.$slots,"rewind")])):a("",!0)]})),_:2},1032,["ready","data-id","index","state","ratio","rewind","tinder-mounted","scale-step","offset-y","offset-unit","onReverted"])):a("",!0)],64)})),256))]})),_:1},8,["onBeforeEnter","onLeave","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onMousedown","onMousemove","onMouseup"])}));z.render=M,z.__scopeId="data-v-808629f4",z.install=function(t){t.component("VueTinder",z)},"undefined"!=typeof window&&window.Vue&&window.Vue.component("tinder",z);export default z;
