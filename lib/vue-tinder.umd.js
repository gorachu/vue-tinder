!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["vue-tinder"]=e(t.Vue)}(this,(function(t){"use strict";var e=function(t){return{status:t?3:0,touchId:null,start:{},move:{},startPoint:1,result:null}},n=0,i=1,s=2,r=3,o=4,a={name:"TinderCard",emits:["reverted"],props:{tinderMounted:{type:Boolean,default:!1},index:{type:Number,required:!0},ready:{type:Boolean,default:!1},state:{type:Object,required:!0},ratio:{type:Number,default:0},rewind:{type:[Number,Boolean],default:!1},scaleStep:{type:Number,required:!0},offsetY:{type:Number,required:!0},offsetUnit:{type:String,required:!0}},data:function(){return{inited:!1,scopedRewind:!1,willDestory:!1}},computed:{curScale:function(){return this.scaleStep*this.index},isCur:function(){return 0===this.index},style:function(){return this.inited?this.state.status===i?this.movingStyle:this.normalStyle:{}},normalStyle:function(){return this.isCur?{opacity:1,transform:"translate3d(0,0,0) rotate(0) scale3d(1,1,1)",transition:"all 500ms cubic-bezier(0.175, 0.885, 0.32, 1.275), z-index 0s"}:{opacity:this.ready?0:1,transform:this.getTransform(),transition:"all 500ms cubic-bezier(0.175, 0.885, 0.32, 1.275) ".concat(this.scopedRewind?80*this.scopedRewind:0,"ms, z-index 0s")}},movingStyle:function(){var t={transition:"none"};if(this.isCur){var e=this.state,n=e.start,i=e.move,s=e.startPoint,r=i.x-n.x||0,o=i.y-n.y||0,a=10*this.ratio*s;t.transform="translate3d(".concat(r,"px,").concat(o,"px,0) rotate(").concat(a,"deg)")}else{var d=Math.abs(this.ratio);d>1&&(d=1),this.ready&&(t.opacity=1*d),t.transform=this.getTransform(d)}return t}},watch:{index:function(t,e){t<e&&(this.scopedRewind=!1)}},created:function(){this.scopedRewind=this.rewind,this.tinderMounted||(this.inited=!0)},mounted:function(){var t=this;requestAnimationFrame((function(){t.inited=!0}))},methods:{transitionEnd:function(t){if(t.target===t.currentTarget&&"transform"===t.propertyName&&(this.scopedRewind=!1,this.isCur)){var e=this.state.status;e!==r&&e!==o||this.$emit("reverted")}},getTransform:function(t){var e=this.index,n=0,i=1-this.scaleStep*e;if(t&&(i+=t*this.scaleStep),this.offsetY){var s=this.offsetY<0,r=Math.abs(this.offsetY),o=e*r,a=(1-i)/2*100;t&&(o-=t*r),s&&(o*=-1,a*=-1),n="calc(".concat(a,"% + ").concat(o).concat(this.offsetUnit,")")}return"translate3d(0,".concat(n,",0) scale3d(").concat(i,",").concat(i,",1)")}}},d=t.withScopeId("data-v-7d6ecee4"),u=d((function(e,n,i,s,r,o){return t.openBlock(),t.createBlock("div",{"data-index":i.index,class:"tinder-card",style:[{zIndex:100-i.index},o.style],onTransitionend:n[1]||(n[1]=function(){return o.transitionEnd&&o.transitionEnd.apply(o,arguments)})},[t.renderSlot(e.$slots,"default"),t.renderSlot(e.$slots,"nope"),t.renderSlot(e.$slots,"like"),t.renderSlot(e.$slots,"super"),t.renderSlot(e.$slots,"down"),t.createVNode(t.Transition,{name:"tinder-rewind"},{default:d((function(){return[!1!==e.scopedRewind?t.renderSlot(e.$slots,"rewind",{key:0}):t.createCommentVNode("",!0)]})),_:1})],44,["data-index"])}));a.render=u,a.__scopeId="data-v-7d6ecee4";var c=function(t,e){for(var n=[],i=0;i<t.length&&!(e.indexOf(t[i])>-1);i++)n.push(t[i]);return n};function h(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var p,y={name:"Tinder",emits:["update:queue","submit"],mixins:[{data:function(){return{leavingKeys:[],onceRewindCount:0}},methods:{diff:function(t,e){var n=this.keyName,i=c(t,e),s=0;if(i.length)for(var r=0;r<i.length;r++){var a=this.queue[r];if(!a[n]||i[r]!==a[n])break;s++;var d=a[n],u=d+Math.random();if(this.leavingKeys.indexOf(a.$vtKey)>-1||this.leavingKeys.indexOf(d)>-1||this.rewindKeys.indexOf(a.$vtKey)>-1||this.rewindKeys.indexOf(d)>-1){a.$vtKey=u;var h=Math.max(this.rewindKeys.indexOf(a.$vtKey),this.rewindKeys.indexOf(d));h>-1&&(this.rewindKeys[h]=u,this.state.status=o)}}this.onceRewindCount=s;var l=c(e,t);if(l.length){this.leavingKeys.push(this.list[0].$vtKey||this.list[0][n]);for(var f=this.max+1;f<this.max+1+l.length;f++){var p=this.list[f];p&&(this.leavingKeys.indexOf(p[n])>-1||this.hidingKeys.indexOf(p[n])>-1)&&(p.$vtKey=p[n]+Math.random())}}this.list=this.queue.slice(0)}}},{methods:{start:function(t){if(null===this.state.touchId&&this.status!==s&&this.status!==r&&this.status!==o){var e,n;"touchstart"===t.type?(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(e=t.clientX,n=t.clientY);var a=n>this.size.top+this.size.height/2?-1:1;this.state={status:i,touchId:"touchstart"===t.type?t.changedTouches[0].identifier:"mouse",start:{x:e,y:n},move:Object.create(null),startPoint:a,result:null}}},move:function(t){t.preventDefault();var e,n,i=this.state;null===i.touchId||this.status===s||this.status===r||this.status===o||"touchmove"===t.type&&i.touchId!==t.changedTouches[0].identifier||("touchmove"===t.type?(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(e=t.clientX,n=t.clientY),i.move={x:e,y:n})},end:function(t){if(("touchstart"!==t.type||this.state.touchId===t.changedTouches[0].identifier)&&this.status!==s&&this.status!==r&&this.status!==o)if(Math.abs(this.pointerOpacity)>=1||this.superOpacity>=1||this.downOpacity>=1){var n=this.superOpacity>=1?"super":this.downOpacity>=1?"down":this.pointerOpacity>0?"like":"nope";this.shiftCard(n)}else this.status===i&&(this.state=e("reverted"))}}},{data:function(){return{leavedCount:0,hideIndex:50,lastHideIndex:50,hidingKeys:[]}},methods:{beforeEnter:function(t){var e=t.dataset.index-0+1;if(t.style.opacity=0,t.style.transform=this.getTransform(e),this.rewindKeys.indexOf(t.dataset.id)>-1){var n=-1,i=(n+=this.size.width*(n<0?-.5:.5))/(.5*this.size.width)/1.6*15*1;t.style.transform="translate3d(".concat(n,"px, 0, 0) rotate(").concat(i,"deg)")}t.style.transition="all 0s"},leave:function(t,e){var i=this,r=this.state,a=r.start,d=r.move,u=r.startPoint,c=d.x-a.x||0,h=d.y-a.y||0;"super"===r.result?h-=this.size.width:"down"===r.result?h+=this.size.width:h*=(c+=this.size.width*(c<0?-.5:.5))/(d.x-a.x);var l=c/(.5*this.size.width)/1.6*15*u,f=null===r.touchId||"super"===r.result||"down"===r.result?800:300;if(t.style.opacity=0,t.style["pointer-events"]="none",this.leavingKeys.indexOf(t.dataset.id)>-1)t.className+=" ".concat(r.result),t.style.transform="translate3d(".concat(c,"px,").concat(h,"px,0) rotate(").concat(l,"deg)"),t.style.zIndex=1e6-this.leavedCount++;else{this.hidingKeys.push(t.dataset.id),f=500;var p=Math.min(this.max,this.onceRewindCount)+(t.dataset.index-0);t.style.transform=this.getTransform(p),t.style.zIndex=this.getHideIndex(t.dataset.index-0)}t.style.transition="all ".concat(f,"ms ").concat(500===f?"cubic-bezier(0.175, 0.885, 0.32, 1.275)":"ease",",z-index 0s"),t.addEventListener("transitionend",(function(r){"transform"===r.propertyName&&(i.lastHideIndex===t.style.zIndex-0&&(i.lastHideIndex=50,i.hideIndex=50),!i.sync||i.status!==n&&i.status!==s||i.resetStatus(),e())})),this.sync||t.dataset.index-0!=0||this.status===o||this.resetStatus()},getHideIndex:function(t){var e,n=this.max;return t===n?this.lastHideIndex>this.hideIndex?(e=this.hideIndex,this.hideIndex+=1+n):e=this.hideIndex++:e=this.hideIndex+n-t,this.lastHideIndex=e,e},getTransform:function(t){var e=1-this.scaleStep*t,n=0;if(this.offsetY){var i=this.offsetY<0,s=t*Math.abs(this.offsetY),r=(1-e)/2*100;i&&(s*=-1,r*=-1),n="calc(".concat(r,"% + ").concat(s).concat(this.offsetUnit,")")}return"translate3d(0,".concat(n,",0) scale3d(").concat(e,",").concat(e,",1)")}}},{data:function(){return{rewindKeys:[]}},methods:{decide:function(t){!this.state.touchId&&this.status===n&&this.queue.length&&(this.state.start={x:0,y:0},this.state.move={x:"super"===t||"down"===t?0:"like"===t?1:-1,y:"super"===t?-1:"down"===t?1:0},this.state.startPoint=1,this.shiftCard(t))},rewind:function(t){var e,n,i=this.keyName,s=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=l(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw r}}}}(t);try{for(s.s();!(n=s.n()).done;){var r=n.value;this.rewindKeys.push(r[i]+"")}}catch(o){s.e(o)}finally{s.f()}(e=this.queue).unshift.apply(e,h(t)),this.$emit("update:queue",this.queue.slice(0))},shiftCard:function(t){this.state.status=s,this.state.result=t;var e=this.queue.shift();this.$emit("update:queue",this.queue.slice(0)),this.submitDecide(t,e)},submitDecide:function(t,e){this.$emit("submit",{type:t,key:e[this.keyName],item:e})}}}],components:{TinderCard:a},props:{allowSuper:{type:Boolean,default:!0},allowDown:{type:Boolean,default:!1},queue:{type:Array,default:function(){return[]}},keyName:{type:String,default:"key"},pointerThreshold:{type:Number,default:.5},superThreshold:{type:Number,default:.5},downThreshold:{type:Number,default:.5},sync:{type:Boolean,default:!1},max:{type:Number,default:3},scaleStep:{type:Number,default:.05},offsetY:{type:Number,default:0},offsetUnit:{type:String,default:"px"}},data:function(){return{size:{top:0,width:0,height:0},state:e(),list:[],tinderMounted:!1}},computed:{status:function(){return this.state.status},ratio:function(){if(this.size.width){var t=this.state,e=t.start;return(t.move.x-e.x||0)/(.5*this.size.width)}return 0},pointerOpacity:function(){return this.ratio/this.pointerThreshold},disY:function(){return this.allowSuper||this.allowDown?this.state.move.y-this.state.start.y:0},superOpacity:function(){if(!this.allowSuper)return 0;var t=this.disY/(-this.superThreshold*this.size.height);return t>Math.abs(this.pointerOpacity)?t:0},downOpacity:function(){if(!this.allowDown)return 0;var t=this.disY/(this.downThreshold*this.size.height);return t>Math.abs(this.pointerOpacity)?t:0},likeOpacity:function(){return this.superOpacity||this.downOpacity?0:this.pointerOpacity},nopeOpacity:function(){return-this.likeOpacity}},watch:{queue:function(t){var e=this.keyName,n=t.map((function(t){return t[e]})),i=this.list.map((function(t){return t[e]}));this.diff(n,i)}},mounted:function(){this.$el.offsetWidth&&this.$el.offsetHeight?(this.size={top:this.$el.offsetTop,width:this.$el.offsetWidth,height:this.$el.offsetHeight},window.onresize=this.getSize,this.tinderMounted=!0):console.error("请设置vue-tinder的宽高")},created:function(){this.list=this.queue.slice(0)},unmounted:function(){window.removeEventListener("onresize",this.getSize)},methods:{getSize:function(){var t=this;clearInterval(p),p=setTimeout((function(){t.size={top:t.$el.offsetTop,width:t.$el.offsetWidth,height:t.$el.offsetHeight}}),300)},resetStatus:function(){this.state=e()}}},m=t.withScopeId("data-v-808629f4");t.pushScopeId("data-v-808629f4");var v={key:1,slot:"rewind",class:"pointer-wrap rewind-pointer-wrap"};t.popScopeId();var w=m((function(e,n,i,s,r,o){var a=t.resolveComponent("TinderCard");return t.openBlock(),t.createBlock(t.TransitionGroup,{class:"vue-tinder",tag:"div",css:!1,onBeforeEnter:e.beforeEnter,onLeave:e.leave,onTouchstart:e.start,onTouchmove:e.move,onTouchend:e.end,onTouchcancel:e.end,onMousedown:e.start,onMousemove:e.move,onMouseup:e.end},{default:m((function(){return[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.list,(function(n,s){return t.openBlock(),t.createBlock(t.Fragment,null,[s<i.max+1?(t.openBlock(),t.createBlock(a,{ready:s===i.max,key:n.$vtKey||n[i.keyName],"data-id":n.$vtKey||n[i.keyName],index:s,state:e.state,ratio:o.ratio,rewind:e.rewindKeys.indexOf(n.$vtKey||n[i.keyName])>-1&&s,"tinder-mounted":e.tinderMounted,"scale-step":i.scaleStep,"offset-y":i.offsetY,"offset-unit":i.offsetUnit,onReverted:o.resetStatus},{default:m((function(){return[t.renderSlot(e.$slots,"default",{data:n,index:s,status:o.status}),0===s&&2!==o.status?(t.openBlock(),t.createBlock(t.Fragment,{key:0},[t.createVNode("span",{slot:"nope",class:"pointer-wrap nope-pointer-wrap",style:{opacity:o.nopeOpacity}},[t.renderSlot(e.$slots,"nope",{opacity:o.nopeOpacity})],4),t.createVNode("span",{slot:"like",class:"pointer-wrap like-pointer-wrap",style:{opacity:o.likeOpacity}},[t.renderSlot(e.$slots,"like",{opacity:o.likeOpacity})],4),i.allowSuper?(t.openBlock(),t.createBlock("span",{key:0,slot:"super",class:"pointer-wrap super-pointer-wrap",style:{opacity:o.superOpacity}},[t.renderSlot(e.$slots,"super",{opacity:o.superOpacity})],4)):t.createCommentVNode("",!0),i.allowDown?(t.openBlock(),t.createBlock("span",{key:1,slot:"down",class:"pointer-wrap down-pointer-wrap",style:{opacity:o.downOpacity}},[t.renderSlot(e.$slots,"down",{opacity:o.downOpacity})],4)):t.createCommentVNode("",!0)],64)):t.createCommentVNode("",!0),4===e.state.status?(t.openBlock(),t.createBlock("span",v,[t.renderSlot(e.$slots,"rewind")])):t.createCommentVNode("",!0)]})),_:2},1032,["ready","data-id","index","state","ratio","rewind","tinder-mounted","scale-step","offset-y","offset-unit","onReverted"])):t.createCommentVNode("",!0)],64)})),256))]})),_:1},8,["onBeforeEnter","onLeave","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onMousedown","onMousemove","onMouseup"])}));return y.render=w,y.__scopeId="data-v-808629f4",y.install=function(t){t.component("VueTinder",y)},"undefined"!=typeof window&&window.Vue&&window.Vue.component("tinder",y),y}));
